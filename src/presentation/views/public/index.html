<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Web App</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="library-header text-white text-center p-4 mb-4 rounded">
                    <h1 class="display-4">ðŸ“š Library Web App</h1>
                    <p class="lead">Browse our collection of books</p>
                </div>

                <!-- Stats Card -->
                <div class="card stats-card mb-4">
                    <div class="card-body text-center">
                        <h5 class="card-title">ðŸ“Š Collection Stats</h5>
                        <p class="card-text">Total Books: <span id="book-count" class="badge bg-primary stats-badge">Loading...</span></p>
                    </div>
                </div>

                <!-- Loading and Error Messages -->
                <div id="loading" class="text-center loading-container">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 loading-text">Loading books...</p>
                </div>
                <div id="error" class="alert alert-danger error-alert d-none" role="alert"></div>

                <!-- Books Table -->
                <div class="card books-table-card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸ“– Books Collection</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover books-table" id="books-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Title</th>
                                        <th scope="col">Author</th>
                                    </tr>
                                </thead>
                                <tbody id="books-tbody">
                                    <!-- Books will be populated here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadBooks() {
            try {
                const response = await fetch('/api/books');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const books = await response.json();
                
                // Hide loading indicator
                document.getElementById('loading').classList.add('d-none');
                
                // Update stats with animation
                const bookCountElement = document.getElementById('book-count');
                bookCountElement.textContent = books.length;
                bookCountElement.classList.add('count-animate');
                setTimeout(() => bookCountElement.classList.remove('count-animate'), 300);
                
                // Render books in table
                const tbody = document.getElementById('books-tbody');
                tbody.innerHTML = '';
                
                if (books.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="3" class="text-center empty-state">
                                <div class="empty-state-icon">ðŸ“š</div>
                                <em>No books found in the library.</em>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                books.forEach((book, index) => {
                    const row = document.createElement('tr');
                    row.className = 'book-row';
                    row.style.animationDelay = `${index * 0.05}s`;
                    row.innerHTML = `
                        <td><span class="book-id">${book.id}</span></td>
                        <td class="book-title">${escapeHtml(book.title)}</td>
                        <td class="book-author">${escapeHtml(book.author)}</td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading books:', error);
                document.getElementById('loading').classList.add('d-none');
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = `Error loading books: ${error.message}`;
                errorDiv.classList.remove('d-none');
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Load books when page loads
        document.addEventListener('DOMContentLoaded', loadBooks);
        
        // Refresh every 30 seconds
        setInterval(loadBooks, 30000);
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>